{% extends "base.html" %}

{% block title %}Assets - IT Inventory Management{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">Assets</h1>
    <a href="{{ url_for('assets.create_asset') }}" class="btn btn-primary btn-sm">
        Add Asset
    </a>
</div>

<!-- Filters -->
<form method="get" class="card mb-3 shadow-sm">
    <div class="card-body">
        <div class="row g-2 align-items-end">
            <div class="col-12 col-md-3">
                <label class="form-label">Status</label>
                <select name="status" class="form-select form-select-sm">
                    {% for value, label in status_choices %}
                        <option value="{{ value }}" {% if status == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-12 col-md-3">
                <label class="form-label">Location</label>
                <select name="location_id" class="form-select form-select-sm">
                    <option value="">All locations</option>
                    {% for loc in locations %}
                        <option value="{{ loc.id }}" {% if location_id|int == loc.id %}selected{% endif %}>
                            {{ loc.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-12 col-md-4">
                <label class="form-label">Search</label>
                <input
                    type="text"
                    name="q"
                    value="{{ q }}"
                    class="form-control form-control-sm"
                    placeholder="Search by name, tag, or serial">
            </div>

            <div class="col-12 col-md-2 text-md-end">
                <button type="submit" class="btn btn-sm btn-outline-primary me-1">
                    Apply
                </button>
                <a href="{{ url_for('assets.list_assets') }}" class="btn btn-sm btn-outline-secondary">
                    Reset
                </a>
            </div>
        </div>
    </div>
</form>

<div class="card shadow-sm">
    <div class="card-body">
        {% if assets %}
            <div class="table-responsive">
                <table class="table table-sm align-middle mb-0">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Asset Tag</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Sub-Category</th>
                            <th>Location</th>
                            <th>Status</th>
                            <th>Purchase Date</th>
                            <th>Warranty Expiry</th>
                            <th>Actions</th>
                        </tr>
                    </thead>

                    <tbody>
                        {% for asset in assets %}
                        <tr>
                            <td>{{ asset.id }}</td>
                            <td>
                                <a href="{{ url_for('assets.asset_detail', asset_id=asset.id) }}" 
                                class="text-decoration-none">
                                    {{ asset.asset_tag }}
                                </a>
                            </td>

                            <td>
                                <a href="{{ url_for('assets.asset_detail', asset_id=asset.id) }}" 
                                class="text-decoration-none">
                                    {{ asset.name }}
                                </a>
                            </td>
                            <td>{{ asset.category.name if asset.category else "-" }}</td>
                            <td>{{ asset.subcategory.name if asset.subcategory else "-" }}</td>
                            <td>{{ asset.location.name if asset.location else "-" }}</td>
                            <td>
                                {% set label_map = {
                                    "in_use": "In Use",
                                    "in_stock": "In Stock",
                                    "under_repair": "Under Repair",
                                    "retired": "Retired",
                                    "disposed": "Disposed"
                                } %}
                                {% set color_map = {
                                    "in_use": "primary",
                                    "in_stock": "success",
                                    "under_repair": "warning",
                                    "retired": "secondary",
                                    "disposed": "dark"
                                } %}
                                {% set status_label = label_map.get(asset.status, asset.status) %}
                                {% set status_color = color_map.get(asset.status, "secondary") %}
                                <span class="badge bg-{{ status_color }}">
                                    {{ status_label }}
                                </span>
                            </td>

                            <td>{{ asset.purchase_date or "-" }}</td>
                            <td>{{ asset.warranty_expiry_date or "-" }}</td>
                            <td>
                                {% if current_user.is_authenticated and current_user.is_admin %}
                                <a href="{{ url_for('assets.edit_asset', asset_id=asset.id) }}">Edit</a>
                                {% else %}
                                <span class="text-muted">View</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>`
        {% else %}
            <p class="text-muted mb-0">
                No assets found. Asset creation form will be added next.
            </p>
        {% endif %}
    </div>
</div>
{% endblock %}
